{% extends 'base.html' %}
{% load static %}
{% block title %}Noticias sobre {{ categoria.nombre }}{% endblock %}
{% block description %} {{post.descripcion}} {% endblock %}
{% block content %}
<div class="blog-area section-padding">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <h2 class="mb-5">Artículos de la categoría: <strong>{{ categoria.nombre }}</strong></h2>
                <div class="mb-4">
                    <span>Ordenar por:</span><!--DEUDA TECNICA: Mejorar el visual de los filtros en la seccion categorias-->
                    <a href="?ordenar=fecha_desc" class="btn btn-sm {% if orden_actual == 'fecha_desc' %}btn-primary{% else %}btn-outline-secondary{% endif %}">Más Recientes</a>
                    <a href="?ordenar=fecha_asc" class="btn btn-sm {% if orden_actual == 'fecha_asc' %}btn-outline-secondary{% else %}btn-secondary{% endif %}">Más Antiguos</a>
                    <a href="?ordenar=titulo_asc" class="btn btn-sm {% if orden_actual == 'titulo_asc' %}btn-secondary{% else %}btn-outline-secondary{% endif %}">Título (A-Z)</a>
                    <a href="?ordenar=titulo_desc" class="btn btn-sm {% if orden_actual == 'titulo_desc' %}btn-secondary{% else %}btn-outline-secondary{% endif %}">Título (Z-A)</a>
                </div>
                <hr>
                {% for post in posts %} <!--Deuda Tecnica: mejorar los estilos-->
                    <article class="blog_item">
                        <div class="blog_item_img">
                            {% if post.imagen.url %}
                            <img class="card-img rounded-0" src="{{ post.imagen.url }}" alt="{{ post.titulo }}">
                            {% else %}
                            <span class="text-muted">Sin imagen</span>
                            {% endif %}
                            <a href="#" class="blog_item_date">
                                <h3>{{ post.fecha_publicacion|date:"d" }}</h3>
                                <p>{{ post.fecha_publicacion|date:"M" }}</p>
                            </a>
                        </div>
                        <div class="blog_details">
                            <a class="d-inline-block" href="{% url 'noticias:post_detail' post.id %}">
                                <h2>{{ post.titulo }}</h2>
                            </a>
                            <p>{{ post.contenido|truncatewords:50|striptags }}</p> 
                            <ul class="blog-info-link">
                                <li><i class="fa fa-user"></i> {{ post.autor.first_name }} {{ post.autor.last_name }}</li><!--Deuda Tecnica: add href perfil autor-->
                                <li><i class="fa fa-comments"></i> {{ post.comentarios.count }} Comentario{% if post.comentarios.count != 1 %}s{% endif %}</li>
                            </ul>
                        </div>
                    </article>
                {% empty %}
                    <p>No hay artículos publicados en esta categoría todavía.</p>
                {% endfor %}
            </div>

            <div class="col-lg-4">
                <div class="blog_right_sidebar">
                    <!--<aside class="single_sidebar_widget search_widget">
                         <form action="#">
                           <div class="form-group">
                              <div class="input-group mb-3">
                                 <input type="text" class="form-control" placeholder='Buscar...'>
                                 <div class="input-group-append">
                                    <button class="btns" type="button"><i class="ti-search"></i></button>
                                 </div>
                              </div>
                           </div>
                           <button class="button rounded-0 primary-bg text-white w-100 btn_1 boxed-btn" type="submit">Buscar</button>
                        </form>
                    </aside> PUEDE SER UNA MEJORA FUTURA-->
                    <aside class="single_sidebar_widget post_category_widget">
                        <h4 class="widget_title">Categorías</h4>
                        <ul class="list cat-list">
                            {% for cat in cat_count %}
                            <li>
                            <a href="{% url 'noticias:posts_por_categoria' cat.id%}" class="d-flex">
                                <p>{{cat.nombre}}</p>
                                <p>({{ cat.num_posts }})</p>
                            </a>
                            </li>
                            {% endfor %}
                        </ul>
                     </aside>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}